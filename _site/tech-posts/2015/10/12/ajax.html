<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="icon" href="/imgs/favicon.ico"/>
    <!--Bootstrap And Octicons-->
    <link rel="stylesheet" href="/lib/bootstrap-3.3.5-dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/octicons/octicons.css" />


    <link rel="stylesheet" href="/css/style.css"/>
    <link rel="stylesheet" href="/css/header.css"/>
    <link rel="stylesheet" href="/css/footer.css"/>

    
        <link rel="stylesheet" href="/css/post.css"/>
    
        <link rel="stylesheet" href="/css/highlight.css"/>
    

    <title>Ji Hao's Blog</title>
</head>
<body>
	<div class="container-fluid" id="default-container">
		
<!--Blog Header-->
<div class="container-fluid">
    <!--<div class="row">
        <div class="alert alert-danger" role="alert" style="border-radius: 0; text-align: center; text-decoration: underline; margin: 0; border: solid 2px gray;">
            <h4>Blog Is Under Developing</h4>
            &lt;!&ndash;<h4>“为社会福，为邦家光，勖哉诸君，努力自强。”</h4>&ndash;&gt;
        </div>
    </div>-->
    <div class="row">
        <div id="index-header">
            <h1><img src="/imgs/logo.png" alt=""/>Ji Hao's Blog</h1>
            <h4 id="motto">
                <span>"Never let it go."</span>
            </h4>
        </div>
    </div>
    <div class="row" id="index-nav">
        <ul>
            <li>
                <a href="/">
                    <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
                    &nbsp;&nbsp;Home
                </a>
            </li>
            <li>
                <a href="/pages/tech-notes.html">
                    <span class="glyphicon glyphicon-ice-lolly-tasted" aria-hidden="true"></span>
                    &nbsp;&nbsp;Tech Posts
                </a>
            </li>

            <li>
                <a href="/pages/essay.html">
                    <span class="glyphicon glyphicon-file" aria-hidden="true"></span>
                    &nbsp;&nbsp;Essay
                </a>
            </li>

            <!--<li>
                <a href="/pages/notebook.html">
                    <span class="glyphicon glyphicon-book" aria-hidden="true"></span>
                    &nbsp;&nbsp;My Notebook
                </a>
            </li>-->
            <li>
                <a href="/pages/about.html">
                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                    &nbsp;&nbsp;About
                </a>
            </li>
        </ul>
        <span id="nav-indicator"></span>
    </div>
</div>
		<div class="row">
    <div class="col-sm-12" id="post-body">
        <div class="post">
          <header>
            <h2>全面理解Ajax</h2>
            <p class="post-meta">
                <span class="octicon octicon-clock"></span>
                Oct 12, 2015
            </p>
            <p class="post-tag">
                <span>
                    
                    <a href="//category/#tech-posts">
                        <span class="octicon octicon-list-unordered"></span>
                        &nbsp;tech-posts
                    </a>
                    
                </span>
                <span>
                    
                    <a class="word-keep" href="//tags/#ajax">
                        <span class="octicon octicon-tag"></span>
                        &nbsp;ajax
                    </a>
                    
                </span>
            </p>
          </header>
          <hr class="boundary">
          <article>
            <p>Ajax = Asynchronous javascript and XML
Ajax 不是一种新的编程语言，而是使用现有技术的新标准。
Ajax 是在不重新加载整个页面的情况下，实现与服务器的数据交互并更新部分页面。</p>

<h3 id="起源：">起源：</h3>

<p>Google Suggest：当你在Google搜索框上输入关键字时，JavaScript会把这些字符发送到服务器，然后服务器会返回一个搜索建议的列表。</p>

<h3 id="原理：">原理：</h3>

<p>XMLHttpRequest对象是Ajax的基础，用于在Browser后台与服务器交换数据。</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">xmlhttp</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// code for IE7+, Firefox, Chrome, Opera, Safari</span>
    <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// code for IE5, 6</span>
    <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>然后发送请求：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// true: async = true;</span>
<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET/POST&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">// send(string), string is only enabled when you use POST requset.</span>
<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</code></pre></div>
<p>你有可能请求到缓存中的数据，为了避免这种情况，应在url后面加上 + Math.random()。</p>

<p>然后服务器响应：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// codes after response</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>解释：
每当 readyState 改变时，就会触发 onreadystatechange 事件。readyState有5种状态，所以onreadystatechange函数在整个请求过程中会被调用5次。
如下所示：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">• 0: 请求未初始化
• 1: 服务器连接已建立
• 2: 请求已接收
• 3: 请求处理中
• 4: 请求已完成，且响应已就绪
</code></pre></div>
<p>而status有以下两种状态：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">200：OK
404: File Not Found
</code></pre></div>
<p>如果要获取服务器相应的内容，我们可以使用XMLHttpRequest对象的responseText和responseXML属性。</p>

<p>在实际开发过程中，我们一般使用回调函数callback的方法调用onreadystatechange：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">xmlhttp</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">ajaxReq</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// code for IE7+, Firefox, Chrome, Opera, Safari</span>
        <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// code for IE5, 6</span>
        <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">ajaxReq</span><span class="p">(</span><span class="nx">myurl</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">readyState</span><span class="o">==</span><span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">status</span><span class="o">==</span><span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;myDiv&quot;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="o">=</span><span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="jquery中的ajax：">jQuery中的Ajax：</h3>

<p>编写常规的 AJAX 代码并不容易，因为不同的浏览器对 AJAX 的实现并不相同。这意味着您必须编写额外的代码对浏览器进行测试。不过，jQuery 团队为我们解决了这个难题，我们只需要一行简单的代码，就可以实现 AJAX 功能。</p>

<p><strong>ajax方法（常用）：</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST/GET&quot;</span>
    <span class="nx">async</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;server/handle.php&quot;</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#username&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">content</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()},</span>
    <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// codes when response is ready</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<p><strong>load方法：</strong></p>

<p>load() 方法从服务器加载数据，并把返回的数据放入被选元素中。</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="nx">URL</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="nx">callback</span><span class="p">);</span>
</code></pre></div>
<p>必需的 URL 参数规定您希望加载的 URL。
可选的 data 参数规定与请求一同发送的查询字符串键/值对集合。
可选的 callback 参数是 load() 方法完成后所执行的函数名称。</p>

<p><strong>get方法：</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// $.get(URL,callback);</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;demo_test.asp&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Data: &quot;</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">&quot;\nStatus: &quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>asp文件：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%
response.write(&quot;This is some text from an external ASP file.&quot;)
%&gt;
</code></pre></div>
<p><strong>post方法：</strong></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// $.post(URL,data,callback);</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;demo_test_post.asp&quot;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Donald Duck&quot;</span><span class="p">,</span>
            <span class="nx">city</span><span class="o">:</span><span class="s2">&quot;Duckburg&quot;</span>
        <span class="p">},</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">status</span><span class="p">){</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Data: &quot;</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">&quot;\nStatus: &quot;</span> <span class="o">+</span> <span class="nx">status</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>asp文件：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;%
dim fname,city
fname=Request.Form(&quot;name&quot;)
city=Request.Form(&quot;city&quot;)
Response.Write(&quot;Dear &quot; &amp; fname &amp; &quot;. &quot;)
Response.Write(&quot;Hope you live well in &quot; &amp; city &amp; &quot;.&quot;)
%&gt;
</code></pre></div>
          </article>
          <hr class="boundary">
        </div>

        <!-- 多说评论框 start -->
        <div class="ds-thread" data-thread-key=/tech-posts/2015/10/12/ajax.html data-title=全面理解Ajax data-url=/tech-posts/2015/10/12/ajax.html></div>
        <!-- 多说评论框 end -->
        <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
        <script type="text/javascript">
            var duoshuoQuery = {short_name:"zhoujihao"};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
        </script>
        <!-- 多说公共JS代码 end -->

    </div>
</div>
		<div class="container-fluid">
    <div class="row">
        <footer id="footer">
            <a href="mailto:249662605@qq.com" class="foot-item" role="button" data-toggle="tooltip" data-placement="top" title="Mail address: 249662605@qq.com">
                <span class="octicon octicon-mail"></span>
                <span>Email@me</span>
            </a>
            |
            <a class="foot-item" href="https://github.com/warpprism" target="_blank">
                <span class="octicon octicon-mark-github"></span>
                <span>My Github</span>
            </a>
            &nbsp;
        </footer>
    </div>
</div>

		<script type="text/javascript" src="/lib/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="/lib/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


	</div>
</body>
</html>
