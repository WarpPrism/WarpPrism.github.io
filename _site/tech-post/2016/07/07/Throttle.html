<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="keywords" content="周吉昊, ZhouJihao, zhoujihao, blog, jihao'sblog, 前端开发, 个人博客"/>
    <meta name="description" content="javascript 函数节流 是一种提升函数执行性能的方法。采用setTimeout定时器的方法，每次调用的时候，会清除已经存在的定时器，并建立一个新的定时器覆盖原来的，从而使函数执行时间重置。"/>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <!--Bootstrap And Octicons-->
    <link rel="stylesheet" href="/lib/bootstrap-3.3.5-dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/octicons/octicons.css" />
    <link rel="stylesheet" type="text/css" href="/lib/animate.css" />

    
        <link rel="stylesheet" href="/build/css/site_base.css"/>
        
            <link rel="stylesheet" href="/build/css/highlight.css"/>
        
            <link rel="stylesheet" href="/build/css/post.css"/>
        
        <!--Google Analysis-->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-79596803-1', 'auto');
          ga('send', 'pageview');
        </script>
    
    <title>JS函数节流原理分析</title>
</head>

<body>
	<div class="container-fluid" id="site-wrapper">
		<div class="container-fluid">
  <div class="row">
    <div id="index-header">
      <h1 class="animated flipInX">
        <img id="logo" src="/build/imgs/logo.png" alt=""/>
        <span id="site-name">Jihao's Blog</span>
      </h1>
      <h4 id="motto"><span><b>Never let it go</b></span></h4>
    </div>
  </div>
  <div class="row" id="index-nav">
    <ul>
      <li>
        <a href="/">
          <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
          &nbsp;&nbsp;Home
        </a>
      </li>
      <li>
        <a href="/pages/tech-notes.html">
          <span class="glyphicon glyphicon-ice-lolly-tasted" aria-hidden="true"></span>
          &nbsp;&nbsp;Tech Posts
        </a>
      </li>
      <li>
        <a href="/pages/essay.html">
          <span class="glyphicon glyphicon-file" aria-hidden="true"></span>
          &nbsp;&nbsp;Essay
        </a>
      </li>
      <li>
        <a href="/pages/about.html">
          <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
          &nbsp;&nbsp;About
        </a>
      </li>
    </ul>
    <span id="nav-indicator"></span>
  </div>
</div>

		<div class="row" id="post-wrapper">
  <div id="post-body">
    <div class="post">
      <div class="header">
        <h2>JS函数节流原理分析</h2>
        <p class="post-meta">
          <span class="octicon octicon-clock"></span>
            Jul 7, 2016
            
            
        </p>
        <div class="post-tag">
          <div>
            
            <a href="javascript:void(0)">
              <span class="octicon octicon-list-unordered"></span>
              tech-post
            </a>
            
          </div>
          <div>
            
            <a href="javascript:void(0)">
              <span class="octicon octicon-tag"></span>
              JavaScript
            </a>
            
          </div>
        </div>
      </div>
      <hr class="boundary">
      <article>
        <p>javascript 函数节流 是一种提升函数执行性能的方法。</p>

<p>问题来源：</p>

<p>如果一个函数在短时间内被频繁调用，比如说 scroll, mousemove, click等事件的回调函数，最终会挤满js的<strong>回调函数队列</strong>。<br />
因此就会造成性能问题或者重复的ajax请求。</p>

<p>解决思路：</p>

<p>采用setTimeout定时器的方法，每次调用的时候，会清除已经存在的定时器，并建立一个新的定时器覆盖原来的，从而使函数执行时间重置。<br />
如果一直触发这个函数，函数的执行期就会无限拖延，除非停止触发。停止触发之后，函数才会在setTimeout规定的delay之后得以执行。</p>

<h4 id="section">例一</h4>

<p>下面是一个按钮点击的例子：</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// example</span>
<span class="kd">var</span> <span class="nx">throttle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">fn</span><span class="p">.</span><span class="nx">timer</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">fn</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span>
  <span class="p">},</span> <span class="nx">delay</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"clicked"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"btn"</span><span class="p">);</span>
<span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">throttle</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</code></pre>
</div>

<p>上述例子在执行的时候，我们可以连续多次的点击按钮，都不会执行fn函数，只有当我们停止点击一段时间（这里是1s）后，fn才最终执行<br />
输出clicked！</p>

<h4 id="section-1">例二</h4>

<p>有时候我们有这样的需求：既不想频繁的调用函数，又想要这个函数在一定时间内定期执行一次，该怎么做呢，我们可以采用一个mustRun变量，<br />
当定时器经过了mustRun规定的时间时，就必须调用这个函数，代码如下：</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">throttle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">mustRun</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">timer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">now</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">previous</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">now</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">previous</span><span class="p">)</span> <span class="p">{</span><span class="nx">previous</span> <span class="o">=</span> <span class="nx">now</span><span class="p">}</span>
        
        <span class="kd">var</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">previous</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mustRun</span> <span class="o">&amp;&amp;</span> <span class="nx">delta</span> <span class="o">&gt;=</span> <span class="nx">mustRun</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="nx">previous</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
            <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"This is delay!"</span><span class="p">);</span>
                <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
            <span class="p">},</span> <span class="nx">delay</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
<span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Window Scroll at:"</span> <span class="o">+</span> <span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">time</span><span class="p">));</span>
<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">onscroll</span> <span class="o">=</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
</code></pre>
</div>

<p>上述例子中，我们不断滚动浏览器窗口，则fn函数在5s内必定执行一次，当我们停止滚动，fn在经过2s的延迟后又会执行一次。</p>

<h4 id="section-2">总结</h4>
<p>JS 函数节流是一种行之有效的性能改善方法，从而改善交互体验。</p>


      </article>
      <hr class="boundary">
    </div>

    <p class="post-copyright">
      本文的版权归作者
      <a href="http://warpprism.github.io">ZhouJihao</a>
      所有，采用
      <a href="http://creativecommons.org/licenses/by-nc/3.0/">Attribution-NonCommercial 3.0 License</a>。
      任何人可以进行转载、分享，但不可在未经允许的情况下用于商业用途；转载请注明出处。感谢配合！
    </p>


    <h2 class="guest-op">
      <span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span>
      &nbsp;Share This Post
    </h2>

    <div class="ds-share flat" data-thread-key="/tech-post/2016/07/07/Throttle" data-title="JS函数节流原理分析" data-images="http://warpprism.github.io/imgs/show4.jpg" data-content="javascript 函数节流 是一种提升函数执行性能的方法。采用setTimeout定时器的方法，每次调用的时候，会清除已经存在的定时器，并建立一个新的定时器覆盖原来的，从而使函数执行时间重置。......" data-url="http://warpprism.github.io/tech-post/2016/07/07/Throttle.html">
      <div class="ds-share-inline">
        <ul class="ds-share-icons-16">
          <li data-toggle="ds-share-icons-more">
            <a class="ds-more" href="javascript:void(0);">分享到：</a>
          </li>
          <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
          <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
          <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
          <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
        </ul>
        <div class="ds-share-icons-more">
        </div>
      </div>
    </div>

    <h2 class="guest-op">
      <span class="glyphicon glyphicon-comment" aria-hidden="true"></span>
      &nbsp;Leave A Comment
    </h2>

    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="/tech-post/2016/07/07/Throttle" data-title="JS函数节流原理分析" data-url="http://warpprism.github.io/tech-post/2016/07/07/Throttle.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"zhoujihao"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    <!-- 多说公共JS代码 end -->

  </div>

  <!-- Return To Top -->
  <a id="top" href="#">
    <span class="glyphicon glyphicon-chevron-up icon" aria-hidden="true"></span>
    <span class="text">Top</span>
  </a>
</div>

		
<div class="container-fluid" id="footer-div">
    <div class="row">
        <div class="footer1">
            <a href="#" class="foot-item" role="button" data-toggle="modal" data-target=".email-modal">
                <span class="octicon octicon-mail"></span>
                <span>Email@me</span>
            </a>
            |
            <a class="foot-item" href="https://github.com/warpprism" target="_blank">
                <span class="octicon octicon-mark-github"></span>
                <span>My Github</span>
            </a>
            |
            <a class="foot-item" href="https://github.com/WarpPrism/WarpPrism.github.io" target="_blank">
                <span class="octicon octicon-heart"></span>
                <span>Download Theme</span>
            </a>
        </div>
    </div>
    <div class="row">
        <div class="footer2">
            <span>Copyright &copy; ZhouJihao</span>
            |
            <span>Powered By Jekyll</span>
        </div>
    </div>


    <div class="modal fade email-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <b>
                        My Email Address
                    </b>
                </div>
                <div class="modal-body">
                    <b>249662605@qq.com</b>
                </div>
            </div>
        </div>
    </div>
</div>

	</div>
	<script type="text/javascript" src="/lib/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="/lib/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>


    
        <script type="text/javascript" src="/build/js/main.js"></script>
        <script type="text/javascript" src="/build/js/main.js"></script>
    


</body>
</html>
